# Implementation Plan: Apps Library & Instrumentation Hub

**Branch**: `002-1-summary-add` | **Date**: 2025-10-12 | **Spec**: [`spec.md`](./spec.md)  
**Input**: Feature specification from `/specs/002-1-summary-add/spec.md`

## Summary

Deliver a local-only “Apps” section that lets testers ingest APKs with metadata, manage a deduplicated library, install and launch apps onto the single rooted emulator, drive optional Frida instrumentation, and operate logcat/proxy tools while enforcing 30-day retention of artifacts. Implementation hinges on extending the existing Node.js (Express) backend and React frontend to orchestrate ADB, aapt2, Frida, and mitmproxy locally, with all services bound to 127.0.0.1.

## Technical Context

**Language/Version**: TypeScript (Node.js 20) backend, TypeScript (React 18 + Vite) frontend  
**Primary Dependencies**: Express 4, ws-scrcpy integration hooks, Zustand store, local CLI tools (ADB, aapt2, frida-server, mitmproxy)  
**Storage**: Local filesystem (structured under `var/` or feature-specific directories) with JSON indexes for metadata  
**Testing**: npm test / Jest for backend, Vite/Test utilities for frontend; manual E2E via emulator  
**Target Platform**: Local Ubuntu host running single rooted Android emulator (API 34)  
**Project Type**: Web application (backend + frontend workspaces)  
**Performance Goals**: Meet spec success criteria (≤30s ingest, ≤10s install+launch, ≤10% CPU logcat tail, timely Frida feedback)  
**Constraints**: Localhost-only networking, single emulator instance, respect 30-day retention, avoid external telemetry  
**Scale/Scope**: Single-operator usage handling hundreds of APK entries and associated artifacts

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **Local-Only Networking**: Plan maintains localhost binding – ✅
- **Single Device Focus**: Feature targets the existing single rooted emulator – ✅
- **Zero External Security Tooling**: Spec introduces Frida integration, conflicting with constitution clause “runtime MUST NOT integrate Frida... in v1” – ⚠️ **Violation**

**Gate Status**: ❌ Blocked until governance approves either (a) constitution amendment to permit local Frida tooling, or (b) scope adjustment removing Frida from this feature. Plan proceeds under assumption that an explicit exception will be granted; otherwise implementation must omit Frida portions.

## Project Structure

### Documentation (this feature)

```
specs/002-1-summary-add/
├── plan.md
├── research.md
├── data-model.md
├── quickstart.md
├── contracts/
└── tasks.md        # generated by /speckit.tasks (future step)
```

### Source Code (repository root)

```
backend/
├── src/
│   ├── api/
│   ├── services/
│   ├── state/
│   └── config/
└── tests/          # add unit/integration coverage for new services

frontend/
├── src/
│   ├── components/
│   ├── hooks/
│   ├── pages/
│   └── services/
└── tests/          # extend React tests for Apps section

var/
└── autoapp/        # existing logs; extend with APK library + logcat storage
```

**Structure Decision**: Continue using the existing backend/frontend workspaces. New feature modules will live under `backend/src` (API routes, services, schedulers) and `frontend/src` (Apps page components, stores) with filesystem artifacts stored beneath `var/autoapp/apps`.

## Complexity Tracking

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|---------------------------------------|
| Constitution “Zero External Security Tooling” | Frida controls are core to requested feature; testers require live instrumentation within UI | Removing Frida undermines a primary user story; manual external tooling would break workflow integration |
